---
id: 67d1ec87b34cee1d9219f7e9
title: 如何在React中创建自定义Hooks？
challengeType: 19
dashedName: how-can-you-create-custom-hooks-in-react
---

# --description--

React提供了许多内置钩子，让你在项目中实现不同的功能。这些包括`useState`、`useEffect`、`useContext`等。

但有时，你需要添加一个内置钩子无法帮助实现的功能。幸运的是，你可以在React中创建自己的自定义钩子。

自定义钩子并不像看起来那么复杂。它们只是可重用的函数，让你在多个组件之间共享逻辑。这意味着可重用性是你想要构建自己钩子的另一个原因。

使用自定义钩子，你可以从使用它们的任何组件中提取逻辑，如数据获取、状态管理、切换、检查用户在线或离线状态等副作用。

然后你可以将钩子导入到任何组件中使用，这样你就可以专注于这些组件内的渲染和展示。这意味着更少的重复和更少的冗余，这意味着当你想要进行任何更新时，需要更改的地方更少。

现在，让我们看看如何制作自己的自定义钩子。

在React中，所有内置钩子都以`use`这个词开头，所以你的自定义钩子应该遵循相同的约定。你的自定义钩子名称也应该清楚地传达它的作用。

所以，如果你的自定义钩子…

- 获取数据，你可以称它为`useFetch`

- 切换某些东西的开和关，你可以称它为`useToggle`

- 或者如果它实现了防抖，`useDebounce`是个好名字

假设你想构建一个自定义钩子来为你的应用程序添加防抖。

防抖是一种编程技术，用于限制函数运行的频率。它通过等待用户停止执行某个操作指定的时间段后再执行函数来工作。例如，在搜索框中，不是对每次按键都进行API调用，防抖会等待用户暂停输入，比如说500毫秒。

要创建防抖自定义钩子，首先需要创建一个`useDebounce.jsx`或`useDebounce.js`文件。按照惯例，你创建的任何自定义钩子文件都保存在`hooks`文件夹中。

你可以在自己的自定义钩子中使用一些内置钩子。对于防抖，你需要`useState`和`useEffect`钩子，所以在文件顶部导入它们：

```js
import { useState, useEffect } from "react";
```

接下来，创建一个`useDebounce`函数，接受`value`和`delay`作为参数。`value`是你想要等待的资源，`delay`是你想要等待的时间段。由于你想等待一段时间，`setTimeout`和`clearTimeout`函数会很有用：

```js
function useDebounce(value, delay) {
  const [debouncedValue, setDebouncedValue] = useState(value);

  useEffect(() => {
    const handler = setTimeout(() => {
      setDebouncedValue(value);
    }, delay);

    return () => {
      clearTimeout(handler);
    };
  }, [value, delay]);

  return debouncedValue;
}

export { useDebounce };
```

`debouncedValue`状态保存并返回延迟的值，该值只在指定的超时时间后更新。

`useEffect`是真正发生魔力的地方。如果你还记得上一课的内容，存在于React渲染周期之外的任何东西，比如设置和清除计时器，都是副作用，你应该使用`useEffect`钩子来处理它们。

在这里的`useEffect`钩子中，你使用`setTimeout`来设置`debouncedValue`。然后你返回一个清理函数，使用`clearTimeout`在`value`或`delay`改变时，或组件卸载时清除之前的超时。

要使用这个钩子，我们准备了一个`footballers`数组，通过一个简单的搜索栏进行过滤：

```js
const footballers = [
  'Lionel Messi', 'Cristiano Ronaldo', 'Neymar Jr',
  'Kylian Mbappe', 'Mohamed Salah', 'Sadio Mane',
  'Kevin De Bruyne', 'Robert Lewandowski', 'Harry Kane',
  'Sergio Ramos', 'Virgil van Dijk', 'Alisson Becker', 
  'Joshua Kimmich', 'Manuel Neuer', 'Karim Benzema', 
  'Thibaut Courtois', 'Eden Hazard', 'Raheem Sterling',
  'Bruno Fernandes', 'Trent Alexander-Arnold', 'Son Heung-min',
  'Pierre-Emerick Aubameyang','Sergio Aguero', 'Luis Suarez', 
  'Luka Modric', 'Casemiro', 'Frenkie de Jong', 'Gerard Pique',
  'Marc-Andre ter Stegen', 'Keylor Navas', 'Angel Di Maria', 
  "N'Golo Kante", 'Kai Havertz', 'Timo Werner', 'Hakim Ziyech', 
  'Christian Pulisic', 'Mason Mount', 'Olivier Giroud', 'Tammy Abraham', 
  'Kepa Arrizabalaga', 'Ben Chilwell', 'Thiago Silva', 'Kurt Zouma', 
  'John Terry', 'Didier Drogba', 'Frank Lampard', 'Ashley Cole', 'Petr Cech',
];

export default footballers;
```

以下是一个`FootballerSearch`组件，使用`useDebounce`钩子在用户停止输入1秒后延迟搜索：

```jsx
import { useState, useEffect } from "react";
import { useDebounce } from "./hooks/useDebounce";
import footballers from "./footballers";

const FootballerSearch = () => {
  const [query, setQuery] = useState("");
  const debouncedQuery = useDebounce(query, 1000); // 在用户停止输入1秒后开始搜索

  useEffect(() => {
    if (debouncedQuery) {
      const results = footballers.filter((footballer) =>
        footballer.toLowerCase().includes(debouncedQuery.toLowerCase()),
      );
      console.log("搜索结果:", results);
    } else {
      console.log("搜索结果: []");
    }
  }, [debouncedQuery]);

  return (
    <>
      <h1 style={{ textAlign: "center" }}>足球运动员搜索应用</h1>
      <div style={{ textAlign: "center" }}>
        <input
          style={{ padding: "0.5rem", width: "30%" }}
          type="text"
          value={query}
          onChange={(e) => setQuery(e.target.value)}
          placeholder="搜索足球运动员..."
        />
      </div>
    </>
  );
};

export default FootballerSearch;
```

如你所见，`debouncedQuery`变量初始化了`useDebounce`钩子，使用查询状态(用户输入的内容)和1000毫秒或1秒的延迟。搜索本身在`useEffect`钩子中处理，搜索结果记录到控制台。

# --questions--

## --text--

在React中创建自定义钩子的显著好处是什么？

## --answers--

它使组件渲染更快。

### --feedback--

自定义钩子帮助避免在不同组件中重复相同的逻辑。

---

它允许你在多个组件之间重用逻辑。

---

它取代了对内置钩子的需求。

### --feedback--

自定义钩子帮助避免在不同组件中重复相同的逻辑。

---

它强制组件共享相同的状态。

### --feedback--

自定义钩子帮助避免在不同组件中重复相同的逻辑。

## --video-solution--

2

## --text--

React中自定义钩子的正确命名约定是什么？

## --answers--

它应该以"`use`"开头。

---

它可以有任何名称。

### --feedback--

考虑钩子的特定前缀。

---

它应该以"`Hook`"结尾。

### --feedback--

考虑钩子的特定前缀。

---

它必须与内置钩子名称匹配。

### --feedback--

考虑钩子的特定前缀。

## --video-solution--

1

## --text--

你会如何命名一个切换值开和关的自定义钩子？

## --answers--

`useSwitch`

### --feedback--

自定义钩子应遵循React的命名约定并清楚地描述其目的。

---

`useToggle`

---

`toggleHook`

### --feedback--

自定义钩子应遵循React的命名约定并清楚地描述其目的。

---

`useBoolean`

### --feedback--

自定义钩子应遵循React的命名约定并清楚地描述其目的。

## --video-solution--

2