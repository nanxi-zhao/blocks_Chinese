---
id: 67d2f7cf63fafe7d20270498
title: 如何使用性能Web API创建自己的性能测量工具？
challengeType: 19
dashedName: how-can-you-use-performance-web-apis-to-create-your-own-performance-measurement-tools
---

# --description--

虽然像Lighthouse和Chrome DevTools这样的工具很棒，但有时你需要针对自己网站的定制化见解。

这就是性能Web API大显身手的地方啦！

在这节课中，我们将详细讲解如何使用三个关键的Web API来测量和分析你网站的速度。

但首先，什么是性能Web API呢？

性能Web API让开发者可以直接从代码中跟踪网页加载和响应的效率。这些API允许你测量页面加载时间、跟踪渲染和交互延迟，并分析JavaScript执行时间。

有了这些API，你就可以构建自己的性能监控工具，而无需依赖第三方软件啦！

让我们一起来探索三个你现在就可以使用的强大Web API吧！

首先登场的是`performance.now()`。

这个API为你提供了高精度的时间戳（以毫秒为单位），用来测量网站不同部分的加载时间。

假设你想测量一个函数运行有多快：

```js
const start = performance.now();  
// Run some code here  
const end = performance.now();  

console.log(`Execution time: ${end - start}ms`);
```

这比使用`Date.now()`更准确，因为它以微秒为单位测量时间，避免了时钟漂移问题。你可以用它来跟踪脚本执行时间、事件响应延迟和动画性能。

接下来是性能计时API。

这个API为你详细分解了页面加载的每一个阶段，从DNS查询到`DOMContentLoaded`。

想测量你的页面完全加载需要多长时间吗？

```js
let [navigationTiming] = performance.getEntriesByType("navigation");

if (navigationTiming instanceof PerformanceNavigationTiming) {
  // Calculate time from navigation start to DOM content loaded
  const pageLoadTime =
    navigationTiming.domContentLoadedEventEnd - navigationTiming.startTime;

  console.log("DOM Content Loaded Time:", pageLoadTime, "ms");
}
```

你可以通过这个API跟踪的关键指标包括DNS查询时间——换句话说就是连接速度，首字节时间(TTFB)——即服务器响应速度，以及`DOMContentLoaded`——换句话说就是页面准备好进行交互的时候。

如果你的页面加载时间很慢，这个API能准确指出延迟发生在哪里！

最后，我们来聊聊`PerformanceObserver`。

这个API会监听性能事件，比如布局偏移、长任务和用户交互。

想监控长时间运行的JavaScript任务吗？

```js
const observer = new PerformanceObserver((list) => {  
  list.getEntries().forEach((entry) => {  
    console.log(`Long task detected: ${entry.duration}ms`);  
  });  
});  

observer.observe({ type: "longtask", buffered: true });
```

这个API能跟踪什么呢？它可以跟踪长任务——换句话说就是阻塞渲染的JavaScript，布局偏移以检测UI卡顿，以及首次输入延迟(FID)——即页面对用户输入的响应速度。

如果你想要实时性能跟踪，这个API绝对是一个改变游戏规则的存在！

那么，你应该使用哪个API呢？这里有一个快速对比：

| Performance API        | Best For                                           |
|:---------------------- |:-------------------------------------------------- |
| `performance.now()`    | 函数和脚本的精确定时                                |
| Performance Timing API | 测量完整页面加载性能                               |
| Performance Observer   | 实时监控交互和渲染                                 |

通过结合使用这些API，你可以构建自己的性能测量工具，并准确跟踪对你网站最重要的指标。

# --questions--

## --text--

What is the main advantage of using `performance.now()` over `Date.now()`?

## --answers--

It's more accurate and measures time in microseconds.

---

It works only on mobile devices and is not supported on desktops.

### --feedback--

Think about why precision matters when measuring speed.

---

It measures system memory usage, including the browser's memory footprint.

### --feedback--

Think about why precision matters when measuring speed.

---

It helps with CSS animations.

### --feedback--

Think about why precision matters when measuring speed.

## --video-solution--

1

## --text--

Which API can track long JavaScript tasks that slow down your site?

## --answers--

Performance Timing API

### --feedback--

Think about an API that listens for performance events in real-time.

---

`Performance.now()`

### --feedback--

Think about an API that listens for performance events in real-time.

---

Performance Observer

---

PageSpeed Insights

### --feedback--

Think about an API that listens for performance events in real-time.

## --video-solution--

3

## --text--

What does the Performance Timing API help measure?

## --answers--

Individual JavaScript function execution time.

### --feedback--

Think about an API that tracks every stage of page loading.

---

Full page load performance, including DNS lookup and TTFB.

---

User interactions like button clicks.

### --feedback--

Think about an API that tracks every stage of page loading.

---

The number of images on a webpage.

### --feedback--

Think about an API that tracks every stage of page loading.

## --video-solution--

2
