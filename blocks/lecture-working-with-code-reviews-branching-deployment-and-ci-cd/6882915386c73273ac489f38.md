---
id: 6882915386c73273ac489f38
title: 开发 Git 分支策略的最佳实践有哪些？
challengeType: 19
dashedName: what-are-some-best-practices-for-developing-a-git-branching-strategy
---

# --description--

我们在之前的课程中稍微谈到了分支。你已经学会了如何创建分支，为什么不应该直接向 `main` 提交，等等。但是你什么时候以及为什么应该实际创建分支呢？

首先，让我们谈谈为什么你不应该只向 `main` 推送一堆提交。你的默认分支应该是可靠稳定的——也就是说，在任何给定时间，我应该能够拉取你当前的 `main` 分支并构建、运行和测试你的应用程序。如果你推送部分完成的功能或 WIP 提交，那么这可能并不总是正确的。

此外，同时处理多个功能是很常见的。如果你同时向 `main` 推送多个功能的部分工作，调试潜在问题会变得更加困难，因为你没有隔离的更改。除此之外，上下文切换（或更改你正在处理的任务）也不会那么清晰。

那么你什么时候应该创建分支呢？一个通用的经验法则是为每个隔离的工作单元创建一个分支。也就是说，如果你正在处理一个新的 OAuth 功能，这项工作应该在专用分支上进行。如果你需要修复密码认证中的错误，这项工作应该在自己的专用分支上进行。需要重新设计用户资料页面？这是另一个分支。

请注意，你应该始终从 `main` 创建你的分支。所以，如果你正在处理 OAuth 功能的分支，你应该在为密码认证修复创建新分支之前检出 `main`。否则，如果你直接从 OAuth 分支为密码修复创建分支，你最终会得到 OAuth 工作的提交，历史记录会变得混乱。

但是你应该如何命名你的分支呢？这完全取决于你（或你正在贡献的项目），但这里有一些常见的约定：

`scope/description` - 其中 `scope` 是像 `feat` 或 `fix` 这样的东西，`description` 是对分支更改的非常简短的解释。例如：`feat/oauth-support`。

`scope/issue/description` - 与之前的约定类似，但包括相关问题的编号。例如：`fix/25/password-auth`。

`username/scope/description` - 对于在原始仓库中使用分支而不是分叉它的项目（这在私有内部仓库中很常见），在分支名称开头包含你的用户名可能会有帮助。例如：`naomi-lgbt/feat/profile-redesign`。

让我们讨论一些关于分支策略的其他注意事项。

对于长期的功能工作，比如需要大量开发人员时间的测试版功能，你可能希望使用功能标志来选择性地启用逻辑，而不是使用分支。分支未合并的时间越长，遇到冲突的可能性就越大。

然而，你可能希望为部署环境或发布维护专用分支。例如，MasterPuti 仓库使用 `prod-staging` 和 `prod-current` 来触发到暂存和生产服务器的部署。这可以让团队更快地迭代，在准备好并获得批准后合并，而无需为每次合并触发部署。相反，部署是通过将最新的 `main` 合并到那些生产分支来创建的。

你可能还想维护"发布分支"，或代表产品主要版本的分支。这允许你为每个主要发布版本保持干净的状态，所以如果你需要将关键的安全补丁回溯到早期发布版本，你可以这样做，而无需包含任何新版本的更改。

最后，你应该避免使用本地 CLI 将分支合并到 `main`。相反，为你的更改创建一个拉取请求并通过该流程合并。这让你有机会确保 CI 中的任何测试都通过（你将在未来的课程中了解这一点），并仔细检查差异视图以确保你只包含了想要合并的更改。

有了这些技巧，你就可以开始分支走向成功了！

# --questions--

## --text--

为什么要避免直接向 `main` 分支提交？

## --answers--

因为 Git 不允许直接向 `main` 提交。

### --feedback--

想想默认分支的稳定性和可靠性要求。

---

因为 `main` 分支应该始终保持可靠稳定。

---

因为向 `main` 提交的提交被永久锁定且无法更改。

### --feedback--

想想默认分支的稳定性和可靠性要求。

---

因为 `main` 分支的性能比功能分支慢。

### --feedback--

想想默认分支的稳定性和可靠性要求。

## --video-solution--

2

## --text--

创建新分支时，以下哪项是最佳实践？

## --answers--

从当前功能分支创建新分支。

### --feedback--

想想保持分支历史清晰和避免意外包含代码。

---

始终从 `main` 创建新分支。

---

只为主要功能创建分支。

### --feedback--

想想保持分支历史清晰和避免意外包含代码。

---

限制自己每周创建一个分支。

### --feedback--

想想保持分支历史清晰和避免意外包含代码。

## --video-solution--

2

## --text--

处理长期功能工作的推荐方法是什么？

## --answers--

创建一个包含所有相关工作的大分支。

### --feedback--

考虑长期未合并的分支可能产生的合并冲突。

---

使用功能标志而不是长期分支。

---

始终使用本地 CLI 直接合并到 `main`。

### --feedback--

考虑长期未合并的分支可能产生的合并冲突。

---

为每个主要功能创建一个新仓库。

### --feedback--

考虑长期未合并的分支可能产生的合并冲突。

## --video-solution--

2