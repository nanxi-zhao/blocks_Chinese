---
id: 67f39bcb48373420f4f12d62
title: 错误处理复习
challengeType: 31
dashedName: review-error-handling
---

# --description--

## Python 中的常见错误

- **语法错误**：当你的代码不遵循 Python 的语法规则时，Python 会引发的错误。例如，代码 `print("Hello there"` 会导致语法错误，消息为 `SyntaxError: '(' was never closed`，因为代码缺少右括号。
- **名称错误**：当你尝试访问未定义的变量或函数时，Python 会引发 `NameError`。例如，如果你在代码中有 `print(username)` 这一行，但没有先定义 `username` 变量，你会得到一个名称错误，消息为 `NameError: name 'username' is not defined`。
- **类型错误**：当你对两个或多个不兼容的数据类型执行操作时，Python 会抛出此错误。例如，如果你尝试将字符串添加到数字中，你会得到错误 `TypeError: can only concatenate str (not "int") to str`。
- **索引错误**：如果你访问列表或其他序列（如元组和字符串）中不存在的索引，你会得到 `IndexError`。例如，在 `Hello world` 字符串中，最后一个字符的索引是 `11`。如果你这样访问字符，`greet = "hello world"; print(greet[12])`，你会得到错误消息 `IndexError: string index out of range`。
- **属性错误**：当你尝试使用对象类型中不存在的方法或属性时，Python 会引发此错误。例如，像 `"hello".append("!")` 这样在字符串上调用 `.append()` 会导致错误，消息为 `AttributeError: 'str' object has no attribute 'append'`。

## Python 中的良好调试技术

- **使用 `print` 函数**：在代码中各处插入 `print()` 语句进行调试有助于你看到变量的值以及代码的执行流程。
- **使用 Python 的内置调试器 (`pdb`)**：Python 提供了一个 `pdb` 模块用于调试。它是 Python 标准库的一部分，所以总是可以使用。使用 `pdb`，你可以使用 `set_trace()` 方法设置跟踪，这样你就可以逐步执行代码并以交互方式检查变量。
- **利用 IDE 调试工具**：许多集成开发环境 (IDE) 和代码编辑器如 Pycharm 和 VS Code 提供调试工具，具有断点、逐步执行、变量检查和其他调试功能。

## 异常处理

- **`try...except`**：这用于执行可能引发异常的代码块。`try` 块是你预期可能发生错误的地方，而 `except` 块接受指定的异常并在引发该指定错误时运行。这是一个示例：

  ```py
  try:
    print(22 / 0)
  except ZeroDivisionError:
    print('你不能除以零！')
    # 你不能除以零！
  ```

  你还可以链接多个 `except` 块，这样你可以处理更多类型的异常：

  ```py
  try:
    number = int(input('输入一个数字：'))
    print(22 / number)
  except ZeroDivisionError:
    print('你不能除以零！')
    # 当你输入 0 时打印：你不能除以零！
  except ValueError:
    print('请输入一个有效的数字！')
    # 当你输入字符串时打印：请输入一个有效的数字！
  ```

- **`else` 和 `finally`**：这些块扩展了 `try...except`。如果没有发生异常，`else` 块会运行。`finally` 块无论是否有错误都会运行。

  ```py
  try:
    result = 100 / 4
  except ZeroDivisionError:
    print('你不能除以零！') # 这不会运行
  else:
    print(f'结果是 {result}') # 结果是 25.0
  finally:
    print('执行完成！') # 执行完成！
  ```

- **异常对象**：这让你可以访问异常本身以进行更好的调试和打印直接错误消息。要访问异常对象，你需要使用 `as` 关键字。这是一个示例：

  ```py
  try:
      value = int('这将引发错误')
  except ValueError as e:
      print(f'捕获到错误：{e}')
      # 捕获到错误：invalid literal for int() with base 10: '这将引发错误'
  ```

- **`raise` 语句**：这允许你手动引发异常。你可以使用它在满足某个条件时抛出异常。这是一个示例：

  ```py
  def divide(a, b):
      if b == 0:
          raise ZeroDivisionError('你不能除以零')
      return a / b
  ```

## 异常信号

  `raise` 语句在创建自己的自定义异常时也很有用，因为你可以使用它来抛出带有自定义消息的异常。这是一个示例：

  ```py
  class InvalidCredentialsError(Exception):
      def __init__(self, message="用户名或密码无效"):
          self.message = message
          super().__init__(self.message)

  def login(username, password):
      stored_username = "admin"
      stored_password = "password123"

      if username != stored_username or password != stored_password:
          raise InvalidCredentialsError()

      return f"欢迎，{username}！"
  ```

  以下是使用 `InvalidCredentialsError` 异常的 `login` 函数的方法：

  ```py
  # 登录失败尝试
  try:
      message = login("user", "wrongpassword")
      print(message)
  except InvalidCredentialsError as e:
      print(f"登录失败：{e}")

  # 成功登录尝试
  try:
      message = login("admin", "password123")
      print(message)
  except InvalidCredentialsError as e:
      # 此块不会执行，因为登录成功
      print(f"登录失败：{e}")
  else:
      # 如果 'try' 块完成而没有异常，else 块会运行
      print(message)
  ```

  `raise` 语句也可以与 `from` 关键字一起使用来链接异常，显示不同错误之间的关系：

  ```py
  def parse_config(filename):
    try:
        with open(filename, 'r') as file:
            data = file.read()
            return int(data)
    except FileNotFoundError:
        raise ValueError('配置文件缺失') from None
    except ValueError as e:
        raise ValueError('配置格式无效') from e

  config = parse_config('config.txt')
  ```

# --assignment--

复习错误处理主题和概念。