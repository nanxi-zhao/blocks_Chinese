---
id: 6724e3d6e1cb0c1fec3a8e4f
title: SQL 和 PostgreSQL 复习
challengeType: 31
dashedName: review-sql-and-postgresql
---

# --description--

## 关系型数据库简介

- **关系型数据库**: 将数据组织成相关的表，表由行和列组成。每行代表一条记录，每列代表数据的一个属性。
- **关系型数据库的优势**: 可扩展，在各个领域（如医疗保健、商业、游戏）广泛适用，并且结构化以保持可靠的数据。
- **常见用例**: Web 开发、库存系统、电子商务、医疗保健和企业应用。

## 关键概念

- **模式**: 关系型数据库需要一个模式来定义其结构——表、列、数据类型、约束和关系。
- **主键**: 表中每行的唯一标识符。它们对数据完整性至关重要，并通过外键用于关联表之间的记录。
- **外键**: 引用另一个表中的主键，用于链接表之间的相关数据。
- **关系**: 通过主键和外键连接表，可以构建规范化数据并执行有意义的查询。
- **实体关系图 (ERD)**: 可视化数据库模式中实体（表）之间的关系。
- **数据完整性**: 使用键和数据类型强制执行。确保存储数据的一致性和准确性。

## SQL 基础

- **查询**: 从数据库中检索特定数据的请求。

```sql
SELECT * FROM dogs WHERE age < 3;
```

- **WHERE 子句**: 根据条件过滤结果。使用比较运算符如 `<`, `=`, `>` 等。
- **带 ORDER BY 的选择**: 根据列检索和排序结果。

```sql
SELECT columns FROM table_name ORDER BY column_name;
```

## 表操作

- **`CREATE TABLE` 语句**: 用于在数据库中创建新表。

```sql
CREATE TABLE first_table();
```

- **`ALTER TABLE ADD COLUMN` 语句**: 用于向现有表添加列。

```sql
ALTER TABLE table_name ADD COLUMN column_name DATATYPE;
```

- **`ALTER TABLE DROP COLUMN` 语句**: 用于从现有表中删除列。

```sql
ALTER TABLE table_name DROP COLUMN column_name;
```

- **`ALTER TABLE RENAME COLUMN` 语句**: 用于重命名表中的列。

```sql
ALTER TABLE table_name RENAME COLUMN column_name TO new_name;
```

- **`DROP TABLE` 语句**: 用于从数据库中删除整个表。

```sql
DROP TABLE table_name;
```

- **`ALTER DATABASE RENAME` 语句**: 用于重命名数据库。

```sql
ALTER DATABASE database_name RENAME TO new_database_name;
```

- **`DROP DATABASE` 语句**: 用于删除整个数据库。

```sql
DROP DATABASE database_name;
```

## 约束和数据完整性

- **带约束的 `ALTER TABLE ADD COLUMN`**: 用于向现有表添加带约束的列。

```sql
ALTER TABLE table_name ADD COLUMN column_name DATATYPE CONSTRAINT;
```

- **`NOT NULL` 约束**: 此约束确保列不能为空值。

```sql
column_name VARCHAR(50) NOT NULL
```

- **`ALTER TABLE ADD PRIMARY KEY` 语句**: 用于向表添加主键约束。

```sql
ALTER TABLE table_name ADD PRIMARY KEY(column_name);
```

- **`ALTER TABLE DROP CONSTRAINT` 语句**: 用于从表中删除约束。

```sql
ALTER TABLE table_name DROP CONSTRAINT constraint_name;
```

- **带外键的 `ALTER TABLE ADD COLUMN`**: 用于添加引用另一个表的外键列。

```sql
ALTER TABLE table_name ADD COLUMN column_name DATATYPE REFERENCES referenced_table_name(referenced_column_name);
```

- **`ALTER TABLE ADD UNIQUE` 语句**: 用于向列添加 UNIQUE 约束。

```sql
ALTER TABLE table_name ADD UNIQUE(column_name);
```

- **`ALTER TABLE ALTER COLUMN SET NOT NULL` 语句**: 用于在现有列上设置 NOT NULL 约束。

```sql
ALTER TABLE table_name ALTER COLUMN column_name SET NOT NULL;
```

- **带 NULL 值的 `INSERT` 语句**: 此语句演示如何向表中插入 NULL 值。

```sql
INSERT INTO table_name(column_a) VALUES(NULL);
-- 或
INSERT INTO table_name(column_b) VALUES('value'); -- 如果 column_a 允许空值
```

- **复合主键**: 此约束定义由多个列组成的主键。

```sql
CREATE TABLE course_enrollments (
    student_id INT,
    course_id INT,
    PRIMARY KEY (student_id, course_id)
);
```

## 数据操作 (CRUD)

- **`INSERT` 语句**: 用于向表中插入单行。

```sql
INSERT INTO table_name(column_1, column_2) VALUES(value1, value2);
```

- **省略列的 `INSERT` 语句**: 此语句显示如何在不显式列出列名的情况下插入值，依赖于表中的默认列顺序。

```sql
INSERT INTO dogs VALUES ('Gino', 3);
```

- **带多行的 `INSERT` 语句**: 用于在单个操作中向表中插入多行。

```sql
INSERT INTO dogs (name, age) VALUES 
('Gino', 3),
('Nora', 2);
```

- **`UPDATE` 语句**: 用于根据条件更新表中的现有数据。

```sql
UPDATE table_name SET column_name=new_value WHERE condition;
```

- **`DELETE` 语句**: 用于根据条件从表中删除行。

```sql
DELETE FROM table_name WHERE condition;
```

## 数据类型

- **`NUMERIC` 数据类型**: 用于存储具有指定精度和小数位数的精确十进制数。

```sql
price NUMERIC(10, 2)
```

- **`TEXT` 数据类型**: 用于存储可变长度的字符串，没有特定的长度限制。

```sql
column_name TEXT
```

- **`INTEGER` 数据类型**: 用于存储不带小数位的整数。

```sql
units_sold INTEGER
```

- **`SMALLINT` 和 `BIGINT` 数据类型**: 这些是 INTEGER 的变体，分别具有较小和较大的范围。

- **`SERIAL` 数据类型**: 用于在 PostgreSQL 中创建自动递增的整数列。

```sql
id SERIAL
```

- **`AUTO_INCREMENT` 属性**: 在 MySQL 中用于创建自动递增的整数列。

```sql
id INT AUTO_INCREMENT
```

- **`VARCHAR` 数据类型**: 用于存储具有指定最大长度的可变长度字符串。

```sql
name VARCHAR(50)
```

- **`DATE` 数据类型**: 用于存储日期值（年、月、日）。

```sql
event_date DATE
```

- **`TIME` 数据类型**: 用于存储时间值（小时、分钟、秒）。

```sql
start_time TIME
```

- **`TIMESTAMP` 数据类型**: 用于存储日期和时间值，可选择带时区信息。

```sql
event_timestamp TIMESTAMP
event_timestamp TIMESTAMP WITH TIME ZONE
```

- **`BOOLEAN` 数据类型**: 用于存储真/假值。

```sql
is_active BOOLEAN
```

## 数据库关系

- **关系类型**: 这些是在关系型数据库中表之间可以关联的不同方式。
  - 一对一
  - 一对多
  - 多对一
  - 多对多
  - 自引用（递归）

- **一对一关系**: 这种关系类型意味着一个表中的每条记录对应另一个表中的恰好一条记录。

```md
一个员工被分配恰好一辆车。
表: employees, vehicles
```

- **一对多关系**: 这种关系类型意味着一个表中的一条记录可以与另一个表中的多条记录关联。

```md
一个客户可以有多个订单。
表: customers → orders
```

- **通过连接表的多对多关系**: 这种关系类型使用包含两个相关表外键的连接表来实现。

```sql
CREATE TABLE books_authors (
    author_id INT REFERENCES authors(id),
    book_id INT REFERENCES books(id)
);
```

- **自引用关系**: 当一个表引用自身时发生这种关系类型，创建层次结构。

```md
员工表中每个员工可能向另一个员工报告。
```

## 高级 SQL (连接)

- **`INNER JOIN` 语句**: 此连接仅返回两个表中具有匹配值的行。

```sql
SELECT *
FROM products
INNER JOIN sales ON products.product_id = sales.product_id;
```

- **`FULL OUTER JOIN` 语句**: 此连接返回两个表中的所有行，包括任一表中不匹配的行。

```sql
SELECT *
FROM products
FULL OUTER JOIN sales ON products.product_id = sales.product_id;
```

- **`LEFT OUTER JOIN` 语句**: 此连接返回左表中的所有行和右表中的匹配行。

```sql
SELECT *
FROM products
LEFT JOIN sales ON products.product_id = sales.product_id;
```

- **`RIGHT OUTER JOIN` 语句**: 此连接返回右表中的所有行和左表中的匹配行。

```sql
SELECT *
FROM products
RIGHT JOIN sales ON products.product_id = sales.product_id;
```

- **`SELF JOIN` 语句**: 用于将表与其自身连接，以比较同一表中的行。

```sql
SELECT A.column_name, B.column_name
FROM table_name A
JOIN table_name B ON A.related_column = B.related_column;
```

- **`CROSS JOIN` 语句**: 此连接返回两个表的笛卡尔积，将第一个表的每一行与第二个表的每一行组合。

```sql
SELECT *
FROM table1
CROSS JOIN table2;
```

## PostgreSQL 特定命令

- **`psql` 登录命令**: 用于使用特定用户名和数据库登录到 PostgreSQL。

```bash
psql --username=MasterPuti --dbname=postgres
```

- **`\l` 命令**: 此命令列出 PostgreSQL 实例中的所有数据库。

```sql
\l
```

- **`CREATE DATABASE` 和 `\c` 命令**: 这些命令用于创建新数据库并连接到它。

```sql
CREATE DATABASE database_name;
\c database_name
```

- **`\d` 命令**: 此命令列出当前数据库中的所有表。

```sql
\d
```

- **`\d table_name` 命令**: 此命令显示特定表的模式/结构。

```sql
\d table_name
```

- **`\q` 命令**: 此命令退出 PostgreSQL 客户端。

```bash
\q
```

## 关系型与非关系型

- **非关系型 (NoSQL) 数据库**: 存储非结构化或半结构化数据。不需要严格的模式，对于不断变化的数据模型更加灵活。
- **关系型与非关系型的选择**: 取决于数据的性质和应用程序需求。
- **关系型与非关系型**: 选择关系型用于结构化数据和一致性；NoSQL 用于灵活性和快速变化的数据。

## 流行的 RDBMS 系统

- **MySQL**: 开源、可靠，在 Web 开发中广泛使用，拥有庞大的社区支持。
- **PostgreSQL**: 开源、高级、可扩展。支持自定义数据类型和服务器端编程。
- **SQLite**: 轻量级、基于文件、无服务器。适用于小型应用程序。
- **Microsoft SQL Server**: 商业级数据库。
- **Oracle Database**: 商业 RDBMS，以大规模性能和可扩展性著称。

## 最佳实践

- **命名约定**: 使用 `snake_case` (例如，`delivery_orders`) 为表和列命名。

# --assignment--

复习 SQL 和 PostgreSQL 主题和概念。