---
id: 6724e18296fa40173cc2437c
title: 网页性能复习
challengeType: 31
dashedName: review-web-performance
---

# --description--

## 真实性能与感知性能的区别

- **感知性能**：这是用户对网站性能的感知。它是用户在响应性和可靠性方面对网站的评价。这是一个主观的测量标准，因此很难量化，但它非常重要，因为用户体验决定了网站的成功或失败。
- **真实性能**：这是网站的客观和可测量的性能。它使用页面加载时间、服务器响应时间和渲染时间等指标进行测量。这些测量受网络和代码本身的多个因素影响。

## 提高感知性能的技术

- **懒加载**：这种技术通过在后台加载非必要资源来尽可能减少初始加载时间。
- **最小化字体延迟**：如果你的网站有自定义字体，你也应该尽量减少字体加载延迟，因为这可能导致闪烁或在加载自定义字体时显示备用字体。对此的建议是使用与自定义字体相似的备用字体，这样即使发生这种情况，变化也会更微妙。
- **使用加载指示器**：在用户点击元素后立即为长时间运行的进程显示加载指示器，可以帮助用户感觉与进程连接并参与其中，使等待时间感觉更短。

## 核心性能概念

- **源代码顺序**：这指的是HTML元素在文档中的结构方式。这决定了什么先加载，可以显著影响性能和可访问性。

源代码顺序的一些最佳实践包括：

- 将关键内容如标题、导航或正文文本放在HTML结构的较高位置。
- 延迟非必要脚本如分析脚本或第三方小部件，这样它们不会阻止渲染。
- 使用渐进增强，确保核心体验在样式和脚本加载之前就能工作。渐进增强是基于你应该首先让页面用HTML工作这一理念来构建网站和应用程序的方法。

以下是使用我们刚才讨论的最佳实践的良好源代码顺序示例：

```html
<h1>欢迎来到FastSite!</h1>
<p>关键信息首先加载。</p>
<script src="slow-script.js" defer></script>
```

- **关键渲染路径**：这是浏览器将代码转换为屏幕上像素的步骤序列。
- **延迟**：这是请求在浏览器和服务器之间传输所需的时间。换句话说，高延迟等于慢页面。

减少延迟的一些方法包括：

- 使用CDN（内容分发网络）从更近的位置提供文件。
- 启用压缩，如使用Gzip来减少文件大小。
- 优化图像并使用懒加载。

```html
<img src="placeholder.jpg" data-src="real-image.jpg" loading="lazy">
```

## 提高INP

- **定义**：INP（Interaction to Next Paint）通过测量用户交互（如点击或按键）到浏览器下次更新显示的时间来评估页面的整体响应性。较低的INP表示页面响应性更好。

提高INP的一些方法：

- 通过分解长时间的JavaScript任务来减少主线程工作。
- 对于非关键脚本使用`requestIdleCallback()`。这将在浏览器空闲期间排队调用函数。
- 延迟或懒加载之前提到的重资产。
- 优化事件处理程序。如果这些处理程序运行过于频繁或执行繁重操作，它们会减慢页面速度并增加INP。对此的解决方案是防抖。防抖确保函数只在用户停止输入短时间延迟（例如300ms）后才运行。这防止了不必要的计算并提高了性能。

## 浏览器中的渲染工作原理

- **渲染工作原理**：首先浏览器解析HTML并构建DOM。接下来，浏览器处理CSS，构建CSS对象模型（CSSOM）。这是另一个树形结构，决定元素应该如何样式化。最后，浏览器将像素绘制到屏幕上，根据计算的样式和布局渲染每个元素。在复杂页面中，这可能涉及多个图层，这些图层组合在一起形成最终的视觉输出。

## 性能如何影响可持续性

- **背景信息**：互联网约占全球碳排放的2%——这与航空业相同！从数据中心到用户设备，传输的每个字节都需要电力。更大的文件和低效的脚本意味着更多的电力消耗。高性能网站不仅更快，还能减少不必要的处理和能源使用。

## 减少页面加载时间的方法

- **优化媒体资产**：大图像和视频是加载时间慢的常见原因。通过优化这些资产，你可以显著加快网站速度。这包括压缩图像、使用WebP等现代格式以及对资产使用懒加载。
- **利用浏览器缓存**：缓存允许浏览器在本地存储网站的部分内容，减少回头客的加载时间。
- **缩小和压缩文件**：减少文件大小可以加快下载速度。这包括减少传输文件的大小以及缩小CSS和JavaScript文件。

## 提高"可用时间"

- **定义**："可用时间"是从用户请求页面到他们可以有意义地与之交互的时间间隔。要提高"可用时间"，你可以懒加载资产或最小化渲染阻塞资源。

## 衡量性能的关键指标

- **首次内容绘制或FCP**：它测量屏幕上出现第一块内容（文本或图像）的速度。良好的FCP被认为是低于1.8秒的时间，而糟糕的FCP是超过3秒。你可以使用Chrome DevTools检查性能选项卡来检查你的FCP。
- **总阻塞时间**：这显示主线程被繁重JavaScript任务阻塞的时间。如果总阻塞时间（TBT）很高，用户会体验到迟钝的交互。要改善TBT，可以分解长时间任务并延迟非必要脚本。
- **跳出率**：这是没有交互就离开的访问者百分比。如果你的网站跳出率很高，可能是因为你的页面太慢。
- **独立用户**：此指标跟踪访问你网站的独立访客数量。要查看跳出率和独立用户，你可以使用Google Analytics。它将允许你监控这些指标并提高参与度。

## 常见的性能测量工具

- **Chrome DevTools**：Chrome DevTools是Google Chrome内置的工具，让你能够实时分析和调试性能。DevTools将显示加载时间、CPU使用率和渲染延迟。它特别适用于测量首次内容绘制（FCP），即用户看到第一个可见内容的速度。如果你的网站感觉很慢，DevTools将帮助你发现瓶颈。
- **Lighthouse**：这是一个自动检查性能、SEO和可访问性的工具。
- **WebPageTest**：此工具让你测试网站从不同位置和设备加载的情况。此工具为你提供网站速度指数、总阻塞时间和其他关键性能指标的详细分解。如果你想了解真实用户在全球范围内如何体验你的网站，WebPageTest就是为此而设计的工具。
- **PageSpeed Insights**：此工具分析你的网站并为移动和桌面设备提供快速改进建议。它会告诉你什么拖慢了你的网站，并给出具体建议，如优化图像、删除渲染阻塞脚本和减少服务器响应时间。PageSpeed Insights是检查Google如何看待你网站性能的快速简便方法。
- **真实用户监控**：RUM工具跟踪实际用户行为，显示真实访问者如何体验你的网站。流行的RUM工具包括Google Analytics，它跟踪页面加载时间和跳出率，以及New Relic或Datadog，它们监控实时性能问题。如果你想要来自实际用户的数据，RUM工具是必不可少的。

## 使用性能Web API

- **定义**：性能Web API让开发人员能够直接在代码中跟踪网页加载和响应的效率。这些API允许你测量页面加载时间、跟踪渲染和交互延迟以及分析JavaScript执行时间。
- **`performance.now()`**：此API为你提供高精度时间戳（以毫秒为单位），以测量网站不同部分加载所需的时间。

```js
const start = performance.now();  
// 在这里运行一些代码  
const end = performance.now();  

console.log(`执行时间: ${end - start}ms`);
```

- **性能计时API**：此API为你提供页面加载每个阶段的分解，从DNS查找到`DOMContentLoaded`。

```js
const timing = performance.timing;  

const pageLoadTime = timing.loadEventEnd - timing.navigationStart;  
console.log(`页面加载时间: ${pageLoadTime}ms`);
```

- **`PerformanceObserver`**：此API监听性能事件，如布局偏移、长时间任务和用户交互。

```js
const observer = new PerformanceObserver((list) => {  
  list.getEntries().forEach((entry) => {  
    console.log(`检测到长时间任务: ${entry.duration}ms`);  
  });  
});  

observer.observe({ type: "longtask", buffered: true });
```

## 提高CSS性能的技术

- **CSS动画**：动画化某些CSS属性，如尺寸、位置和布局，会触发称为"回流"的过程，在此期间浏览器重新计算页面上某些元素的位置和几何形状。这需要重绘，这在计算上是昂贵的。因此，建议尽可能减少CSS动画数量，或至少给用户一个切换它们的选项。

## 提高JavaScript性能的技术

- **代码分割**：将JavaScript代码分割成执行关键和非关键任务的模块也是有帮助的。这样，你将能够尽快预加载关键模块，并将非关键模块推迟到尽快渲染页面。
- **DOM操作**：记住DOM操作是指通过与文档对象模型（DOM）交互，使用JavaScript动态更改页面内容的过程。DOM操作在计算上是昂贵的。通过减少JavaScript代码中的DOM操作量将提高性能。

# --assignment--

复习网页性能主题和概念。